{% extends 'tours/base.html' %}
{% load static %}

{% block title %}{{ category.name }} - Hakuna Matata Tours{% endblock %}

{% block content %}

<section class="page-banner-wrapper">
  <div class="page-banner" style="background-image: url('{{ category.image.url }}');">
      <h1 class="page-banner-title">{{ category.name }}</h1>
  </div>
</section>
<div class="container section-padding">

    {% if gallery_images %}
<div class="mobile-slider-wrapper">
    <div class="mobile-gallery-slider">
        {% for gallery_item in gallery_images %}
        <a href="{{ gallery_item.image.url }}" class="glightbox" data-gallery="mobile-city-gallery">
            <div class="slider-image">
                <img src="{{ gallery_item.image.url }}" alt="{{ gallery_item.caption|default:category.name }}">
            </div>
        </a>
        {% endfor %}
    </div>
    <button class="slider-arrow prev-arrow" type="button">&#8249;</button>
    <button class="slider-arrow next-arrow" type="button">&#8250;</button>
</div>
{% endif %}

    <div class="category-layout-grid">
        
        <div class="main-content-column">
            
            <section class="page-section">
                <div class="prose-content">
                    {{ category.description|safe }}
                    {{ category.highlights_text|safe }}
                </div>
            </section>
            
            {% if category.featured_hotels.all %}
<section class="page-section">
    <h2 class="section-title">Featured Hotels in {{ category.name }}</h2>
    <div class="horizontal-slider-wrapper">
        <div class="hotel-card-grid horizontal-slider">
            {% for hotel in category.featured_hotels.all %}
                <div class="hotel-card" 
                    data-hotel-id="{{ hotel.id }}"
                    data-name="{{ hotel.name }}"
                    data-stars="{{ hotel.stars }}"
                    data-images='[{% for img in hotel.images.all %}"{{ img.image.url }}"{% if not forloop.last %},{% endif %}{% endfor %}]'
                    data-amenities='[{% for amenity in hotel.amenities.all %}{"name": "{{ amenity.name }}", "icon": "{{ amenity.icon }}"}{% if not forloop.last %},{% endif %}{% endfor %}]'

                    data-description='"{{ hotel.description|escapejs }}"'
                    data-details='"{{ hotel.additional_details|safe|escapejs }}"'>

                    {% if hotel.images.first.image.url %}
                        <img src="{{ hotel.images.first.image.url }}" alt="{{ hotel.name }}">
                    {% endif %}
                    <div class="hotel-card-content">
                        <h3>{{ hotel.name }}</h3>
                        <p>{{ hotel.description|striptags|truncatewords:20 }}</p>
                        <button type="button" class="btn-secondary view-hotel-details">View Details</button>
                    </div>
                </div>

                {% with "description-"|add:hotel.id as desc_id %}
                {{ hotel.description|json_script:desc_id }}
            {% endwith %}
            {% with "details-"|add:hotel.id as details_id %}
                {{ hotel.additional_details|safe|json_script:details_id }}
            {% endwith %}

                {% endfor %}
        </div>
        <button class="slider-arrow prev-arrow" type="button">&#8249;</button>
        <button class="slider-arrow next-arrow" type="button">&#8250;</button>
    </div>
</section>
{% endif %}
            
            {% if category.activities.all %}
           <section class="page-section">
               <h2 class="section-title">Top Activities</h2>
               <div class="activity-accordion">
                 {% for activity in category.activities.all %}
               <div class="accordion-item">
            <button class="accordion-header" type="button">
                <i class="{{ activity.icon|default:'fas fa-check' }}"></i>
                <h4>{{ activity.title }}</h4>
                <span class="accordion-icon">+</span>
            </button>
            <div class="accordion-content">
                <p>{{ activity.description }}</p>
            </div>
        </div>
        {% endfor %}
    </div>
</section>
            {% endif %}
            
            <section class="page-section booking-form-section" id="page-booking-form">
    <h2 class="section-title">Book Your Stay</h2>
    <form method="POST" class="custom-booking-form">
        {% csrf_token %}
        
        <div class="form-group full-width">
            <label for="{{ form.full_name.id_for_label }}">Full Name</label>
            {{ form.full_name }}
        </div>
        <div class="form-group">
            <label for="{{ form.email.id_for_label }}">Email</label>
            {{ form.email }}
        </div>
        <div class="form-group">
            <label for="{{ form.phone_number.id_for_label }}">Phone Number</label>
            {{ form.phone_number }}
        </div>
        
        <div class="form-group">
            <label for="{{ form.start_date.id_for_label }}">Start Date</label>
            {{ form.start_date }}
        </div>
        <div class="form-group">
            <label for="{{ form.number_of_days.id_for_label }}">Number of Days</label>
            {{ form.number_of_days }}
        </div>
        <div class="form-group">
            <label for="{{ form.adults.id_for_label }}">Adults</label>
            {{ form.adults }}
        </div>
        <div class="form-group">
            <label for="{{ form.children.id_for_label }}">Children (Under 6)</label>
            {{ form.children }}
        </div>
        
        <div class="form-group full-width">
            <label for="{{ form.hotel.id_for_label }}">Preferred Hotel</label>
            {{ form.hotel }}
        </div>
        <div class="form-group full-width">
            <label for="{{ form.address.id_for_label }}">Address (Optional)</label>
            {{ form.address }}
        </div>
        <div class="form-group full-width">
            <label for="{{ form.comment.id_for_label }}">Additional Comment (Optional)</label>
            {{ form.comment }}
        </div>
        
        <div class="form-group full-width">
            <button type="submit" class="btn-primary">Submit Inquiry</button>
        </div>
    </form>
</section>

        </div>
        
        <div class="sidebar-gallery-column">
            
            {% if gallery_images %}
            <h3 class="sidebar-title">Glimpses of {{ category.name }}</h3>
            <div class="sidebar-gallery-grid">
                {% for gallery_item in gallery_images %}
                <a href="{{ gallery_item.image.url }}" class="glightbox" data-gallery="city-gallery">
                    <div class="gallery-image">
                        <img src="{{ gallery_item.image.url }}" alt="{{ gallery_item.caption|default:category.name }}">
                    </div>
                </a>
                {% endfor %}
            </div>
            {% endif %}

            {% if featured_tours %}
            <h3 class="sidebar-title" style="margin-top: 30px;">Featured Trips</h3>
            <div class="sidebar-tours-list">
                {% for tour in featured_tours %}
                <a href="{% url 'tour_detail' tour.id %}" class="sidebar-tour-item">
                    {% if tour.main_image %}
                    <img src="{{ tour.main_image.url }}" alt="{{ tour.name }}">
                    {% endif %}
                    <span>{{ tour.name }}</span>
                </a>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        
    </div>
</div>
<div class="modal fade" id="hotelDetailModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="hotelModalTitle">Hotel Name</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="hotelModalBody">
        </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="modalBookNowBtn">Book Now</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}