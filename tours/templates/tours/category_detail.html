{% extends 'tours/base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{{ category.name }} - Hakuna Matata Tours{% endblock %}

{% block content %}

<section class="page-banner-wrapper">
  <div class="page-banner" style="background-image: url('{{ category.image.url }}');">
      <h1 class="page-banner-title">{{ category.name }}</h1>
  </div>
</section>
<div class="container section-padding">

    {% if gallery_images %}
<div class="mobile-slider-wrapper">
    <div class="mobile-gallery-slider">
        {% for gallery_item in gallery_images %}
        <a href="{{ gallery_item.image.url }}" class="glightbox" data-gallery="mobile-city-gallery">
            <div class="slider-image">
                <img src="{{ gallery_item.image.url }}" alt="{{ gallery_item.caption|default:category.name }}">
            </div>
        </a>
        {% endfor %}
    </div>
    <button class="slider-arrow prev-arrow" type="button">&#8249;</button>
    <button class="slider-arrow next-arrow" type="button">&#8250;</button>
</div>
{% endif %}

    <div class="category-layout-grid">
        
        <div class="main-content-column">
            
            <section class="page-section">
                <div class="prose-content">
                    {{ category.description|safe }}
                    {{ category.highlights_text|safe }}
                </div>
            </section>
            
            {% if category.featured_hotels.all %}
<section class="page-section">
    <h2 class="section-title">{% blocktrans %}Featured Hotels in {{ category.name }}{% endblocktrans %}</h2>
    <div class="horizontal-slider-wrapper">
        <div class="hotel-card-grid horizontal-slider">
            {% for hotel in category.featured_hotels.all %}
                <div class="hotel-card" 
                    data-hotel-id="{{ hotel.id }}"
                    data-name="{{ hotel.name }}"
                    data-price="{{ hotel.price_per_night|floatformat:0 }}"
                    data-stars="{{ hotel.stars }}"
                    data-images='[{% for img in hotel.images.all %}"{{ img.image.url }}"{% if not forloop.last %},{% endif %}{% endfor %}]'
                    data-amenities='[{% for amenity in hotel.amenities.all %}{"name": "{{ amenity.name }}", "icon": "{{ amenity.icon }}"}{% if not forloop.last %},{% endif %}{% endfor %}]'
                    data-description='"{{ hotel.description|escapejs }}"'
                    data-details='"{{ hotel.additional_details|safe|escapejs }}"'>

                    {% if hotel.images.first.image.url %}
                        <img src="{{ hotel.images.first.image.url }}" alt="{{ hotel.name }}">
                    {% endif %}
                    <div class="hotel-card-content">
                        <h3>{{ hotel.name }}</h3>
                        <p>{{ hotel.description|striptags|truncatewords:20 }}</p>
                        <button type="button" class="btn-secondary view-hotel-details">{% trans "View Details" %}</button>
                    </div>
                </div>

                {% with "description-"|add:hotel.id as desc_id %}
                {{ hotel.description|json_script:desc_id }}
            {% endwith %}
            {% with "details-"|add:hotel.id as details_id %}
                {{ hotel.additional_details|safe|json_script:details_id }}
            {% endwith %}

            {% endfor %}
        </div>
        <button class="slider-arrow prev-arrow" type="button">&#8249;</button>
        <button class="slider-arrow next-arrow" type="button">&#8250;</button>
    </div>
</section>
{% endif %}


{% if featured_tours %}
<section class="tours-section section-padding">
    <div class="container">
        <h2 class="section-title">{% trans "Featured Trips in" %} {{ category.name }}</h2>
        <div class="horizontal-scroll-container">
            <div class="horizontal-scroll-wrapper">
                {% for tour in featured_tours %}
                <div class="scroll-item">
                    <div class="card h-100">
                        <img src="{{ tour.get_card_image_url }}" class="card-img-top" alt="{{ tour.name }}">
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">{{ tour.name }}</h5>
                            <p class="card-text">{{ tour.description|striptags|truncatewords:15 }}</p>
                            <a href="{% url 'tour_detail' tour.id %}" class="btn btn-primary mt-auto align-self-start">{% trans "View Details" %}</a>
                        </div>
                    </div>
                </div>
                {% empty %}
                <p>{% trans "No featured tours available in this category at the moment." %}</p>
                {% endfor %}
            </div>
        </div>
    </div>
</section>
{% endif %}


{% if main_tours %}
<section class="tours-section section-padding bg-light">
    <div class="container">
        <h2 class="section-title">{% trans "More Tours in" %} {{ category.name }}</h2>
        <div class="horizontal-scroll-container">
            <div class="horizontal-scroll-wrapper">
                {% for tour in main_tours %}
                <div class="scroll-item">
                    <div class="card h-100">
                        <img src="{{ tour.get_card_image_url }}" class="card-img-top" alt="{{ tour.name }}">
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">{{ tour.name }}</h5>
                            <p class="card-text">{{ tour.description|striptags|truncatewords:15 }}</p>
                            <a href="{% url 'tour_detail' tour.id %}" class="btn btn-primary mt-auto align-self-start">{% trans "View Details" %}</a>
                        </div>
                    </div>
                </div>
                {% empty %}
                <p>{% trans "No other tours available in this category at the moment." %}</p>
                {% endfor %}
            </div>
        </div>
    </div>
</section>
{% endif %}
            
            {% if category.activities.all %}
           <section class="page-section">
               <h2 class="section-title">{% trans "Top Activities" %}</h2>
               <div class="activity-accordion">
                   {% for activity in category.activities.all %}
                   <div class="accordion-item">
                <button class="accordion-header" type="button">
                    <i class="{{ activity.icon|default:'fas fa-check' }}"></i>
                    <h4>{{ activity.title }}</h4>
                    <span class="accordion-icon">+</span>
                </button>
                <div class="accordion-content">
                    <p>{{ activity.description }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
</section>
            {% endif %}
            
            <section class="page-section booking-form-section" id="page-booking-form">
    <h2 class="section-title">{% trans "Book Your Stay" %}</h2>
    
    <div class="row justify-content-center">
        <div class="col-lg-10"> 
    <form method="POST" class="custom-booking-form row g-3 p-4 border rounded shadow-sm">
                {% csrf_token %}
        
                {% if form.non_field_errors %}
                    <div class="col-12">
                        <div class="alert alert-danger">
                            {% for error in form.non_field_errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
        
                <div class="col-md-4 form-group">
                    <label for="{{ form.full_name.id_for_label }}">{% trans "Full Name" %}</label>
                    {{ form.full_name }}
                    {% if form.full_name.errors %}<div class="invalid-feedback d-block">{{ form.full_name.errors.as_text }}</div>{% endif %}
                </div>
                <div class="col-md-4 form-group">
                    <label for="{{ form.email.id_for_label }}">{% trans "Email" %}</label>
                    {{ form.email }}
                    {% if form.email.errors %}<div class="invalid-feedback d-block">{{ form.email.errors.as_text }}</div>{% endif %}
                </div>
                <div class="col-md-4 form-group">
                    <label for="{{ form.phone_number.id_for_label }}">{% trans "Phone Number" %}</label>
                    {{ form.phone_number }}
                    {% if form.phone_number.errors %}<div class="invalid-feedback d-block">{{ form.phone_number.errors.as_text }}</div>{% endif %}
                </div>
                <hr class="my-3">
        
                <div class="col-md-6 form-group">
                    <label for="{{ form.hotel.id_for_label }}">{% trans "Preferred Hotel" %}</label>
                    {{ form.hotel }}
                    {% if form.hotel.errors %}<div class="invalid-feedback d-block">{{ form.hotel.errors.as_text }}</div>{% endif %}
                </div>
                <div class="col-md-6 form-group">
                    <label for="{{ form.start_date.id_for_label }}">{% trans "Start Date" %}</label>
                    {{ form.start_date }}
                    {% if form.start_date.errors %}<div class="invalid-feedback d-block">{{ form.start_date.errors.as_text }}</div>{% endif %}
                </div>
        
                <div class="col-md-4 form-group">
                    <label for="{{ form.number_of_days.id_for_label }}">{% trans "Number of Days" %}</label>
                    {{ form.number_of_days }}
                    {% if form.number_of_days.errors %}<div class="invalid-feedback d-block">{{ form.number_of_days.errors.as_text }}</div>{% endif %}
                </div>
                <div class="col-md-4 form-group">
                    <label for="{{ form.adults.id_for_label }}">{% trans "Adults" %}</label>
                    {{ form.adults }}
                    {% if form.adults.errors %}<div class="invalid-feedback d-block">{{ form.adults.errors.as_text }}</div>{% endif %}
                </div>
                <div class="col-md-4 form-group">
                    <label for="{{ form.children.id_for_label }}">{% trans "Children (Under 6)" %}</label>
                    {{ form.children }}
                    {% if form.children.errors %}<div class="invalid-feedback d-block">{{ form.children.errors.as_text }}</div>{% endif %}
                </div>
        
                <div class="col-12 form-group">
                    <label for="{{ form.address.id_for_label }}">{% trans "Address (Optional)" %}</label>
                    {{ form.address }}
                    {% if form.address.errors %}<div class="invalid-feedback d-block">{{ form.address.errors.as_text }}</div>{% endif %}
                </div>
                <div class="col-12 form-group">
                    <label for="{{ form.comment.id_for_label }}">{% trans "Additional Comment (Optional)" %}</label>
                    {{ form.comment }}
                    {% if form.comment.errors %}<div class="invalid-feedback d-block">{{ form.comment.errors.as_text }}</div>{% endif %}
                </div>
                
                <div class="col-md-6 form-group mt-3 d-flex justify-content-center align-items-center"> 
                    {{ form.captcha }}
                    {% if form.captcha.errors %}<div class="invalid-feedback d-block">{{ form.captcha.errors.as_text }}</div>{% endif %}
                </div>
                <div class="col-md-6 form-group mt-3">
                    <button type="submit" class="btn-primary w-100">{% trans "Submit Inquiry" %}</button>
                </div>
            </form>

    </div>
    </div>
    </section>
    </div>
    <div class="sidebar-gallery-column">
            
            {% if gallery_images %}
            <h3 class="sidebar-title">{% blocktrans %}Glimpses of {{ category.name }}{% endblocktrans %}</h3>
            <div class="sidebar-gallery-grid">
                {% for gallery_item in gallery_images %}
                <a href="{{ gallery_item.image.url }}" class="glightbox" data-gallery="city-gallery">
                    <div class="gallery-image">
                        <img src="{{ gallery_item.image.url }}" alt="{{ gallery_item.caption|default:category.name }}">
                    </div>
                </a>
                {% endfor %}
            </div>
            {% endif %}

    </div>

        </div> 
        </div> </div> <div class="modal fade" id="hotelDetailModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="hotelModalTitle">{% trans "Hotel Name" %}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="hotelModalBody">
        </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans "Close" %}</button>
        <button type="button" class="btn btn-primary" id="modalBookNowBtn">{% trans "Book Now" %}</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}